<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Civciv'in Not Defteri</title>
    
    <link rel="icon" type="image/png" href="civciv.png">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            /* Arka Plan Rengi: Koyu Mürdüm */
            background-color: #302638; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            margin: 0;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none; 
            cursor: pointer; 
        }

        /* --- YAPIMCI İMZASI (FOOTER) --- */
        .creator-footer {
            position: absolute;
            bottom: 15px;
            width: 100%;
            text-align: center;
            font-size: 12px;
            letter-spacing: 1px;
            font-weight: 300;
            color: rgba(255, 255, 255, 0.3); /* "Made by" kısmı silik kalsın */
            pointer-events: none; /* Boşluklara tıklayınca bir şey olmasın */
            z-index: 100; /* En üstte dursun */
        }

        /* Link Stili */
        .creator-footer a {
            color: rgba(255, 255, 255, 0.3); /* Başlangıç rengi silik */
            text-decoration: none; /* Alt çizgi yok */
            transition: all 0.3s ease; /* Yumuşak geçiş */
            pointer-events: auto; /* SADECE linke tıklanabilsin */
            cursor: pointer;
            font-weight: bold;
        }

        /* Mouse Üzerine Gelince (Hover) */
        .creator-footer a:hover {
            color: #ffffff; /* Bembeyaz olsun */
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8); /* Parlama efekti */
        }

        /* --- 3D Sahne --- */
        .book-container {
            position: relative;
            width: 500px;
            height: 600px;
            perspective: 2000px;
            cursor: default; 
            transition: transform 0.3s ease;
            z-index: 1; 
        }

        .book {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 1s ease-in-out;
        }

        .book.open {
            transform: translateX(250px); 
        }

        /* --- MOBİL UYUMLULUK --- */
        @media (max-width: 768px) {
            .book.open {
                transform: translateX(10px) rotateY(-5deg); 
            }
            .close-tab {
                width: 50px !important;
                height: 120px !important;
                font-size: 16px !important;
            }
        }

        /* --- Kapak --- */
        .cover {
            position: absolute;
            width: 100%;
            height: 100%;
            transform-origin: left;
            transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
            z-index: 10;
            cursor: pointer;
        }

        .book.open .cover {
            transform: rotateY(-180deg);
            cursor: default;
        }

        /* --- KAPATMA ŞERİDİ --- */
        .close-tab {
            position: absolute;
            right: -40px; 
            top: 45%;
            width: 40px;
            height: 100px;
            background-color: #e74c3c;
            color: white;
            border-radius: 0 10px 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            writing-mode: vertical-rl;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.2);
            z-index: 1; 
            transition: opacity 0.3s;
            opacity: 0; 
        }

        .book.open .close-tab {
            opacity: 1;
            z-index: 20; 
        }

        /* --- KAPAĞIN ÖN YÜZÜ --- */
        .front-face {
            position: absolute;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #dcb0ff, #a778e6);
            border-radius: 10px 20px 20px 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #4a235a; 
            backface-visibility: hidden;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.3);
            z-index: 2;
            border: 2px solid #9b59b6;
        }

        .cover-text {
            font-size: 2.5em;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.6);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* --- Kağıt Yapıları --- */
        .paper-base {
            position: absolute;
            background-color: #fdfbf7;
            background-size: 100% 100%;
            overflow: hidden;
            transition: background-image 0.3s;
        }
        .pattern-line { background-image: linear-gradient(#bdc3c7 1px, transparent 1px); background-size: 100% 25px; }
        .pattern-grid { background-image: linear-gradient(#bdc3c7 1px, transparent 1px), linear-gradient(90deg, #bdc3c7 1px, transparent 1px); background-size: 20px 20px; }
        .pattern-blank { background-image: none; }

        .back-face {
            width: 100%; height: 100%;
            border-radius: 10px 20px 20px 10px;
            transform: rotateY(180deg);
            backface-visibility: hidden;
            box-shadow: inset -10px 0 20px rgba(0,0,0,0.1);
            z-index: 1;
        }

        .paper {
            top: 0; left: 0;
            width: 98%; height: 98%;
            margin-top: 1%;
            border-radius: 5px 15px 15px 5px;
            z-index: 5;
            box-shadow: inset 10px 0 20px rgba(0,0,0,0.1);
        }

        canvas {
            display: block;
            width: 100%; height: 100%;
            cursor: crosshair; 
            touch-action: none; 
            transition: opacity 0.3s;
        }
        
        .page-turning canvas { opacity: 0.2; }

        .page-footer { position: absolute; bottom: 15px; width: 100%; display: flex; justify-content: center; pointer-events: none; }
        .page-number { font-size: 14px; color: #95a5a6; font-weight: bold; }

        .nav-btn {
            position: absolute; bottom: 20px;
            font-size: 24px; color: #2c3e50;
            cursor: pointer; z-index: 50;
            transition: transform 0.2s, color 0.2s;
            background: none; border: none; pointer-events: auto;
        }
        .nav-btn:hover { transform: scale(1.2); color: #8e44ad; }
        .next-btn { right: 20px; }
        .prev-btn { left: 20px; display: none; }

        /* --- MENÜ --- */
        .menu-container {
            position: absolute; top: 20px; right: 20px; z-index: 100;
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            opacity: 0; pointer-events: none; transition: opacity 0.5s 0.5s;
        }
        .book.open .menu-container { opacity: 1; pointer-events: auto; }

        .toggle-btn {
            width: 50px; height: 50px; border-radius: 50%;
            background: #9b59b6; color: white; border: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); cursor: pointer;
            font-size: 1.2rem; transition: transform 0.3s, background 0.3s;
            display: flex; justify-content: center; align-items: center;
        }
        .toggle-btn:hover { transform: scale(1.1); background: #af7ac5; }
        .toggle-btn.active { background: #e74c3c; transform: rotate(45deg); }

        .tools-panel {
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(5px);
            padding: 10px; border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex; flex-direction: column; gap: 10px;
            width: 50px; align-items: center;
            max-height: 0; opacity: 0; overflow: hidden;
            transition: max-height 0.4s ease-out, opacity 0.3s;
        }
        .tools-panel.show { max-height: 500px; opacity: 1; }

        .tool-btn { background: none; border: none; cursor: pointer; font-size: 1.2rem; color: #7f8c8d; transition: color 0.3s; }
        .tool-btn:hover { color: #2c3e50; }
        .tool-btn.active { color: #9b59b6; }

        .color-wrapper { position: relative; width: 30px; height: 30px; border-radius: 50%; overflow: hidden; border: 2px solid #ddd; cursor: pointer; }
        input[type="color"] { position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; cursor: pointer; border: none; padding: 0; -webkit-appearance: none; appearance: none; }

        .slider-container { height: 60px; display: flex; justify-content: center; }
        input[type="range"] { writing-mode: bt-lr; -webkit-appearance: slider-vertical; appearance: slider-vertical; width: 8px; height: 100%; cursor: pointer; }

        .pattern-group {
            display: flex; flex-direction: column; gap: 5px;
            border-top: 1px solid #ddd; border-bottom: 1px solid #ddd;
            padding: 5px 0; width: 100%; align-items: center;
        }
        .pattern-btn {
            font-size: 14px; width: 30px; height: 30px;
            border-radius: 5px; border: 1px solid #eee;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; color: #7f8c8d;
        }
        .pattern-btn:hover { background: #ecf0f1; }
        .pattern-btn.active { background: #9b59b6; color: white; border: none; }

    </style>
</head>
<body>

<div class="creator-footer">
    Made by <a href="https://x.com/wraithuso" target="_blank">@wraithuso</a>
</div>

<div class="book-container" id="bookContainer">
    <div class="book" id="book">
        
        <div class="cover" id="cover">
            <div class="front-face">
                <div class="cover-text">CİVCİV'İN NOT DEFTERİ</div>
            </div>
            
            <div class="back-face paper-base pattern-blank" id="leftPageContainer">
                <div class="close-tab" id="closeTab">KAPAT</div>
                <canvas id="leftCanvas"></canvas>
                <div class="page-footer"><span class="page-number" id="leftPageNum">1</span></div>
                <button class="nav-btn prev-btn" id="prevBtn" title="Önceki Sayfa">
                    <i class="fa-solid fa-share" style="transform: scaleX(-1);"></i>
                </button>
            </div>
        </div>

        <div class="paper paper-base pattern-blank" id="rightPageContainer">
            <canvas id="rightCanvas"></canvas>
            <div class="page-footer"><span class="page-number" id="rightPageNum">2</span></div>
            <button class="nav-btn next-btn" id="nextBtn" title="Sonraki Sayfa">
                <i class="fa-solid fa-share"></i>
            </button>
            
            <div class="menu-container">
                <button class="toggle-btn" id="mainToggleBtn"><i class="fa-solid fa-pencil"></i></button>
                <div class="tools-panel" id="toolsPanel">
                    <div class="color-wrapper" title="Renk Seç"><input type="color" id="colorPicker" value="#2c3e50"></div>
                    <button class="tool-btn" id="eraserBtn" title="Silgi"><i class="fa-solid fa-eraser"></i></button>
                    <div class="slider-container" title="Kalem Kalınlığı"><input type="range" id="brushSize" min="1" max="20" value="3"></div>
                    <button class="tool-btn" id="undoBtn" title="Geri Al"><i class="fa-solid fa-rotate-left"></i></button>
                    <div class="pattern-group">
                        <button class="pattern-btn active" data-pattern="pattern-blank" title="Düz Kağıt"><i class="fa-regular fa-square"></i></button>
                        <button class="pattern-btn" data-pattern="pattern-line" title="Çizgili Kağıt"><i class="fa-solid fa-bars"></i></button>
                        <button class="pattern-btn" data-pattern="pattern-grid" title="Kareli Kağıt"><i class="fa-solid fa-border-all"></i></button>
                    </div>
                    <button class="tool-btn" id="clearBtn" title="Sayfayı Temizle"><i class="fa-solid fa-trash"></i></button>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    const cover = document.getElementById('cover');
    const book = document.getElementById('book');
    const bookContainer = document.getElementById('bookContainer');
    const closeTab = document.getElementById('closeTab');
    const leftCanvas = document.getElementById('leftCanvas');
    const rightCanvas = document.getElementById('rightCanvas');
    const leftPageContainer = document.getElementById('leftPageContainer');
    const rightPageContainer = document.getElementById('rightPageContainer');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const leftPageNum = document.getElementById('leftPageNum');
    const rightPageNum = document.getElementById('rightPageNum');
    const mainToggleBtn = document.getElementById('mainToggleBtn');
    const toolsPanel = document.getElementById('toolsPanel');
    const mainIcon = mainToggleBtn.querySelector('i');
    const colorPicker = document.getElementById('colorPicker');
    const brushSize = document.getElementById('brushSize');
    const clearBtn = document.getElementById('clearBtn');
    const eraserBtn = document.getElementById('eraserBtn');
    const undoBtn = document.getElementById('undoBtn');
    const patternBtns = document.querySelectorAll('.pattern-btn');

    let currentSpreadIndex = 0; 
    let savedContent = {}; 
    let undoStack = { left: [], right: [] };

    function scaleBookForMobile() {
        const screenWidth = window.innerWidth;
        const screenHeight = window.innerHeight;
        const bookWidth = 500; 
        const bookHeight = 600;
        if (screenWidth < bookWidth + 40 || screenHeight < bookHeight + 40) {
            const scaleX = (screenWidth - 20) / bookWidth;
            const scaleY = (screenHeight - 20) / bookHeight;
            const scale = Math.min(scaleX, scaleY, 1); 
            bookContainer.style.transform = `scale(${scale})`;
        } else {
            bookContainer.style.transform = 'scale(1)';
        }
    }
    window.addEventListener('load', scaleBookForMobile);
    window.addEventListener('resize', scaleBookForMobile);


    function loadFromLocalStorage() {
        const data = localStorage.getItem('myProNotebook');
        if (data) {
            savedContent = JSON.parse(data);
            if (savedContent.paperPattern) {
                applyPattern(savedContent.paperPattern);
            }
        }
    }

    function saveToLocalStorage() {
        saveCurrentDrawingsToMemory();
        localStorage.setItem('myProNotebook', JSON.stringify(savedContent));
    }

    function saveCurrentDrawingsToMemory() {
        savedContent['L' + currentSpreadIndex] = leftCanvas.toDataURL();
        savedContent['R' + currentSpreadIndex] = rightCanvas.toDataURL();
    }

    function saveStateForUndo(side) {
        const canvas = side === 'left' ? leftCanvas : rightCanvas;
        undoStack[side].push(canvas.toDataURL());
        if(undoStack[side].length > 10) undoStack[side].shift();
    }

    let lastInteractedSide = 'right';

    undoBtn.addEventListener('click', () => {
        const stack = undoStack[lastInteractedSide];
        if (stack.length > 0) {
            const prevState = stack.pop();
            const img = new Image();
            img.src = prevState;
            const canvas = lastInteractedSide === 'left' ? leftCanvas : rightCanvas;
            const ctx = canvas.getContext('2d');
            img.onload = () => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
            };
        }
    });

    function applyPattern(patternClass) {
        ['pattern-blank', 'pattern-line', 'pattern-grid'].forEach(p => {
            leftPageContainer.classList.remove(p);
            rightPageContainer.classList.remove(p);
        });
        leftPageContainer.classList.add(patternClass);
        rightPageContainer.classList.add(patternClass);
        patternBtns.forEach(btn => {
            btn.classList.toggle('active', btn.dataset.pattern === patternClass);
        });
        savedContent.paperPattern = patternClass;
        saveToLocalStorage();
    }

    patternBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.stopPropagation();
            applyPattern(btn.dataset.pattern);
        });
    });

    function changePage(direction) {
        saveToLocalStorage();
        undoStack = { left: [], right: [] };
        leftPageContainer.classList.add('page-turning');
        rightPageContainer.classList.add('page-turning');
        if (direction === 'next') currentSpreadIndex++;
        else if (direction === 'prev' && currentSpreadIndex > 0) currentSpreadIndex--;
        setTimeout(() => {
            const ctxL = leftCanvas.getContext('2d');
            const ctxR = rightCanvas.getContext('2d');
            ctxL.clearRect(0, 0, leftCanvas.width, leftCanvas.height);
            ctxR.clearRect(0, 0, rightCanvas.width, rightCanvas.height);
            loadImagesToCanvas();
            updatePageNumbers();
            prevBtn.style.display = currentSpreadIndex === 0 ? 'none' : 'block';
            leftPageContainer.classList.remove('page-turning');
            rightPageContainer.classList.remove('page-turning');
        }, 300);
    }

    function loadImagesToCanvas() {
        if (savedContent['L' + currentSpreadIndex]) {
            const imgL = new Image();
            imgL.src = savedContent['L' + currentSpreadIndex];
            imgL.onload = () => leftCanvas.getContext('2d').drawImage(imgL, 0, 0);
        }
        if (savedContent['R' + currentSpreadIndex]) {
            const imgR = new Image();
            imgR.src = savedContent['R' + currentSpreadIndex];
            imgR.onload = () => rightCanvas.getContext('2d').drawImage(imgR, 0, 0);
        }
    }

    function updatePageNumbers() {
        leftPageNum.innerText = (currentSpreadIndex * 2) + 1;
        rightPageNum.innerText = (currentSpreadIndex * 2) + 2;
    }

    nextBtn.addEventListener('click', (e) => { e.stopPropagation(); changePage('next'); });
    prevBtn.addEventListener('click', (e) => { e.stopPropagation(); changePage('prev'); });

    mainToggleBtn.addEventListener('click', (e) => {
        e.stopPropagation(); 
        toolsPanel.classList.toggle('show');
        mainToggleBtn.classList.toggle('active');
        if (mainToggleBtn.classList.contains('active')) {
            mainIcon.classList.remove('fa-pencil'); mainIcon.classList.add('fa-xmark');
        } else {
            mainIcon.classList.remove('fa-xmark'); mainIcon.classList.add('fa-pencil');
        }
    });

    cover.addEventListener('click', (e) => {
        if(e.target === closeTab) {
            book.classList.remove('open');
            return;
        }
        if(e.target.closest('.nav-btn') || e.target.tagName === 'CANVAS') return;
        if(currentSpreadIndex === 0 && !book.classList.contains('open')) {
            book.classList.add('open');
        }
    });

    document.body.addEventListener('click', (e) => {
        if (!e.target.closest('.book') && book.classList.contains('open')) {
            book.classList.remove('open');
        }
    });

    function resizeCanvases() {
        loadFromLocalStorage();
        [leftCanvas, rightCanvas].forEach(canvas => {
            const temp = canvas.toDataURL();
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            const img = new Image();
            img.onload = () => canvas.getContext('2d').drawImage(img,0,0);
            img.src = temp;
        });
        loadImagesToCanvas();
    }
    
    window.addEventListener('load', resizeCanvases);
    window.addEventListener('resize', resizeCanvases);
    window.addEventListener('beforeunload', saveToLocalStorage);

    let isDrawing = false;
    let isEraser = false;
    let lastX = 0, lastY = 0;

    function getCoordinates(e, canvas) {
        const rect = canvas.getBoundingClientRect();
        let clientX, clientY;
        if (e.touches && e.touches.length > 0) {
            clientX = e.touches[0].clientX;
            clientY = e.touches[0].clientY;
        } else {
            clientX = e.clientX;
            clientY = e.clientY;
        }
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        return { x: (clientX - rect.left) * scaleX, y: (clientY - rect.top) * scaleY };
    }

    function startDrawing(e) {
        if (e.type === 'touchstart') e.preventDefault();
        if(e.target.closest('.menu-container') || e.target.closest('.nav-btn') || e.target === closeTab) return;
        isDrawing = true;
        const coords = getCoordinates(e, e.target);
        [lastX, lastY] = [coords.x, coords.y];
        lastInteractedSide = e.target.id === 'leftCanvas' ? 'left' : 'right';
        saveStateForUndo(lastInteractedSide);
    }

    function draw(e) {
        if (e.type === 'touchmove') e.preventDefault();
        if (!isDrawing) return;
        const ctx = e.target.getContext('2d');
        const coords = getCoordinates(e, e.target);
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(coords.x, coords.y);
        ctx.globalCompositeOperation = isEraser ? "destination-out" : "source-over";
        ctx.lineWidth = isEraser ? brushSize.value * 2 : brushSize.value;
        if(!isEraser) ctx.strokeStyle = colorPicker.value;
        ctx.lineCap = 'round'; ctx.lineJoin = 'round';
        ctx.stroke();
        [lastX, lastY] = [coords.x, coords.y];
    }

    function stopDrawing(e) { 
        if(isDrawing) {
            isDrawing = false;
            saveToLocalStorage();
        }
    }

    [leftCanvas, rightCanvas].forEach(canvas => {
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);
        canvas.addEventListener('touchstart', startDrawing, {passive: false});
        canvas.addEventListener('touchmove', draw, {passive: false});
        canvas.addEventListener('touchend', stopDrawing);
    });

    clearBtn.addEventListener('click', () => {
        saveStateForUndo('left');
        saveStateForUndo('right');
        [leftCanvas, rightCanvas].forEach(c => c.getContext('2d').clearRect(0,0,c.width,c.height));
        delete savedContent['L' + currentSpreadIndex];
        delete savedContent['R' + currentSpreadIndex];
        saveToLocalStorage();
    });

    eraserBtn.addEventListener('click', () => {
        isEraser = !isEraser;
        eraserBtn.classList.toggle('active');
    });
    
    colorPicker.addEventListener('input', () => {
        isEraser = false;
        eraserBtn.classList.remove('active');
    });

</script>
</body>
</html>